// Generated by CoffeeScript 1.9.3

/* 

  builder = new MimeBuilder({ 
    file: [file object], 
    onBuilt: (b) -> 
      b.boundary
      b.body
  })
 */

(function() {
  window.FiveKit.MimeBuilder = (function() {
    function MimeBuilder() {}

    MimeBuilder.prototype.build = function(options1) {
      var file, options, that;
      this.options = options1;
      options = this.options;
      file = this.options.file;
      that = this;
      this.reader = new FiveKit.FileReader({
        onLoaded: function(e) {
          var binary, body, boundary, reader;
          reader = e.srcElement || e.target;
          binary = reader.result;
          boundary = options.boundary || 'xxxxxxxxx';
          body = '--' + boundary + "\r\n";
          body += "Content-Disposition: form-data; name='upload'; ";
          if (file.name) {
            body += "filename='" + encodeURIComponent(file.name) + "'\r\n";
          }
          body += "Content-Type: application/octet-stream\r\n\r\n";
          body += binary + "\r\n";
          body += '--' + boundary + '--';
          if (options.onBuilt) {
            return options.onBuilt({
              file: file,
              body: body,
              boundary: boundary,
              binary: binary
            });
          }
        }
      });
      return this.reader.reader.readAsBinaryString(file);
    };

    return MimeBuilder;

  })();

}).call(this);
